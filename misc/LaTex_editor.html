<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeX</title>

    <!-- Load MathJax (latest version) -->
    <script type="text/javascript" async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 100%;
            margin: auto;
            padding: 0px 5px;
        }

        #inputTextarea {
            width: 100%;
            min-width: 100%;
            max-width: 100%;
            height: 500px;
            padding: 5px 5px;
            box-sizing: border-box;
            font-size: 16px;
        }

        .subtitle {
            border-bottom: 1px solid #827d71;
            margin: 10px 0px;
        }
    </style>

    <link href="./assets/favicon.ico" rel="shortcut icon">
</head>

<body>

    <h1>Live LaTeX Rendering with MathJax (v1.0)</h1>


    <div style="display: grid; gap: 0px 20px;  grid-template-columns: 50% 50%;">
        <div>
            <div style="display: flex;align-items: center; justify-content: space-between;">
                <p style="margin: 10px 0px;"><a href="https://katex.org/docs/supported.html"
                        target="_blank" />https://katex.org/docs/supported.html</a></p>
                <div style="margin: 10px 0px">
                    <button id="split">split by \\\\</button>
                    <button id="copyInOneLine">shrink to oneline and copy</button>

                </div>
            </div>

            <textarea id="inputTextarea" placeholder="Please enter LaTex code here..."></textarea>
        </div>


        <div>
            <p class="subtitle">output:</p>

            <div id="outputDiv"></div>
        </div>

    </div>

    </div>

</body>
<script>
    let _ita = document.body.querySelector("#inputTextarea");
    let _odiv = document.body.querySelector("#outputDiv");

    function _RemoveLaTexMark(value) {
        let _value = value.trim();

        // remove marks;
        if (_value.startsWith("$$") || _value.startsWith("\[")) {
            _value = _value.substring(2);
        }
        if (_value.endsWith("$$") || _value.endsWith("\]")) {
            _value = _value.substring(0, _value.length - 2);
        }
        return _value;
    }
    _ita.oninput = (e) => _renderLaTex(_ita.value);
    // _ita.onchange=(e)=> _renderLaTex(_ita.value);

    function _renderLaTex(value) {
        // remove marks;
        let _value = _RemoveLaTexMark(value);

        // add marks
        _value = `$$${_value}$$`;

        _odiv.textContent = _value;
        MathJax.typeset();  // Re-render MathJax after adding content
    }

    let _copyOneLine = document.body.querySelector("#copyInOneLine");
    _copyOneLine.onclick = (e) => {
        // remove marks;
        let _value = _RemoveLaTexMark(_ita.value);
        if (_value.length <= 0) return;
        let _arr = _value.split(/[\n]/);
        let _value2 = `$$${_arr.join('')}$$`;
        navigator.clipboard.writeText(_value2)
        // .then(function() {
        //     // Show success message
        //     document.getElementById('message').textContent = 'Text copied to clipboard!';
        // })
        // .catch(function(err) {
        //     // Show error message
        //     document.getElementById('message').textContent = 'Failed to copy text: ' + err;
        // });
    }

    let _splitBtn = document.body.querySelector("#split");
    _splitBtn.onclick = (e) => {
        let _value = _ita.value.trim();
        if (_value.length <= 0) return;
        let _value2 = '';
        let _arr = _value.split(/\\\\/);

        let i = 0;
        for (let N = _arr.length - 1; i < N; ++i) {
            _value2 += `${_arr[i]}\\\\\n\n`;
        }
        _value2 += `${_arr[i]}\n`;
        _ita.value = _value2;
    }
</script>

</html>